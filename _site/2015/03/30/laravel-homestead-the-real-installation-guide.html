<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>jan.zavrel.net - thoughts | stories | ideas</title>
    <meta name="description" content="jan.zavrel.net, development blog" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />

    <!-- Customisation  -->
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css" />
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

</head>
<body class="home-template">
    
    <header class="main-header no-cover">
        <nav class="main-nav overlay clearfix">
            


  <a class="back-button" href="/"><i class="fa fa-1x fa-arrow-left"></i> Home</a>




<!-- <a class="subscribe-button" href="/rss.xml"><i class="fa fa-1x fa-rss"></i> Subscribe</a> //-->


        </nav>
        
        <div class="vertical">
            <div class="main-header-content inner">
                <h1 class="page-title">jan.zavrel.net</h1>
                <h2 class="page-description">
                 thoughts | stories | ideas 
                </h2>
            </div>
        </div>
        <a class="scroll-down" href="#content" data-offset="-45"><i class="fa fa-1x fa-chevron-down"></i><span class="hidden">Scroll Down</span></a>
    </header>

    <header class="main-header post-head no-cover">
    <nav class="main-nav  clearfix">
        


  <a class="back-button" href="/"><i class="fa fa-1x fa-arrow-left"></i> Home</a>




<!-- <a class="subscribe-button" href="/rss.xml"><i class="fa fa-1x fa-rss"></i> Subscribe</a> //-->


    </nav>
</header>

<main class="content" role="main">

    <article class="post">

        <header class="post-header">
            <h1 class="post-title">Laravel/Homestead - the real installation guide</h1>
            <section class="post-meta">
                
                
                
                	
                		<section class="post-author">
                			<img class="author-thumb" src="/assets/images/author-image.png" alt="author image" nopin="nopin" />
                			Jan Zavrel
                	</section>
                	
                	
            	
                
                <time class="post-date" datetime="2015-03-30">30 Mar 2015</time>
                <!--
                
                    on laravel
                
                //-->
                
                
                <!-- check if post has any tags and generate link for every tag  //-->
            	
              		
                  	<i class="fa fa-1x fa-tag"></i> <a href="/tag-laravel.html">Laravel</a>&nbsp;&nbsp;
              		
            	
            	
            	
            	
            	
            </section>
        </header>

<!--         <header class="post-header">
            <a id="blog-logo" href="">
                
                    <img src="mojelogo" alt="jan.zavrel.net" />
                
            </a>
        </header> -->

        <!-- <span class="post-meta">
            <time datetime="2015-03-30">30 Mar 2015</time>
            
        </span> -->

        <!-- <h1 class="post-title">Laravel/Homestead - the real installation guide</h1> -->

        <section class="post-content">
            <p>I got stuck when following <a href="https://laracasts.com/lessons/say-hello-to-laravel-homestead-two">Say Hello to Laravel Homestead 2.0</a> tutorial, because there is one huge omission. Here is the complete step by step guide.</p>

<p>Just <strong>Follow</strong> and then read <strong>Explain</strong> if you want to know more.</p>

<h3 id="follow">Follow</h3>

<ol>
  <li>
    <p>Get a Mac or use Ubuntu on bare metal machine (not virtualized, more on that in Explain section below)</p>
  </li>
  <li>
    <p>Go to <a href="https://www.vagrantup.com">www.vagrantup.com</a> and hit download <em>(don’t use apt-get on Ubuntu, since it will give you old version 1.0.1 while current version is 1.7.x)</em></p>
  </li>
  <li>
    <p>Install vagrant_X.X.X.dmg file <em>(or .deb file on Ubuntu, where you probably already have some older version of Vagrant installed)</em></p>
  </li>
  <li>
    <p>Open terminal</p>
  </li>
  <li>
    <p>Install PHP, CURL and <a href="https://getcomposer.org">Composer</a></p>

    <div class="highlighter-rouge"><pre class="highlight"><code> sudo apt-get install php5-cli

 sudo apt-get install curl

 curl -sS https://getcomposer.org/installer | php
</code></pre>
    </div>
  </li>
  <li>
    <p>Create these two folders if they don’t exist already <em>(they don’t exist in OS X Yosemite, you should already have them in Ubuntu)</em></p>

    <div class="highlighter-rouge"><pre class="highlight"><code> sudo mkdir /usr/local

 sudo mkdir /usr/local/bin
</code></pre>
    </div>
  </li>
  <li>
    <p>Move composer file to newly created folder</p>

    <div class="highlighter-rouge"><pre class="highlight"><code> sudo mv composer.phar /usr/local/bin/composer
</code></pre>
    </div>

    <p>On Ubuntu you will be able to access it globally since <strong>/usr/local/bin</strong> is already in your PATH by default. On Yosemite however, you might need to add <strong>/usr/local/bin</strong> to your PATH like this:</p>

    <div class="highlighter-rouge"><pre class="highlight"><code> sudo nano ~/.bash_profile  and add this line at the end of the file:

 export PATH="/usr/local/mysql/bin:$PATH"
</code></pre>
    </div>
  </li>
</ol>

<p>Write changes <strong>CTRL + O</strong>, <strong>ENTER</strong> to confirm file name and <strong>CTRL + X</strong> to exit nano</p>

<ol>
  <li>
    <p>Install <a href="https://www.virtualbox.org">VirtualBox</a> on Mac or run this command on Ubuntu:
         sudo apt-get install virtualbox-qt</p>
  </li>
  <li>
    <p>Install Homestead box to Vagrant <em>(choose virtualbox when asked, this will take a while, so make a coffee)</em></p>

    <div class="highlighter-rouge"><pre class="highlight"><code> vagrant box add laravel/homestead
</code></pre>
    </div>
  </li>
  <li>
    <p>Install Homestead CLI tool</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>composer global require "laravel/homestead=~2.0"
</code></pre>
    </div>
  </li>
</ol>

<p>If you’re on Ubuntu 12.04 LTS, you will probably have PHP version 5.3.x which is not enough for Homestead. If this is your case, then you will end up with
<strong>Installation failed, deleting ./composer.json</strong> error.</p>

<p>To fix this, just run these commands to get PHP 5.5:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    sudo add-apt-repository ppa:ondrej/php5

			sudo apt-get update

			sudo apt-get dist-upgrade
</code></pre>
</div>

<p>Then run the first command of this step again.</p>

<ol>
  <li>
    <p>Make homestead executable accessible globally by adding this line to ~/.bash_profile (or /etc/bash.bashrc on Ubuntu):</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>export PATH="~/.composer/vendor/bin:$PATH"
</code></pre>
    </div>

    <p>And restart terminal.</p>
  </li>
  <li>
    <p>Create Projects folder in your home folder (default Code folder would work just fine, but we want to have an opportunity to modify our YAML file and this is good reason)</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>mkdir ~/Projects
</code></pre>
    </div>
  </li>
  <li>
    <p>Cd into Projects folder and create Homestead.yaml configuration file</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>homestead init
</code></pre>
    </div>

    <p>Homestead.yaml will be placed in ~/.homestead directory and you need to edit it:</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>homestead edit
</code></pre>
    </div>

    <p>Now you want to change <em>Code</em> directory in yaml file to <em>Projects</em> directory and lowercase <em>Laravel</em> to <em>laravel</em> so it looks this way (on Ubuntu there might be more at the end of file):</p>

    <h2 id="section">```</h2>
    <p>ip: “192.168.10.10”
memory: 2048
cpus: 1
provider: virtualbox</p>

    <p>authorize: ~/.ssh/id_rsa.pub</p>

    <p>keys:
    - ~/.ssh/id_rsa</p>

    <p>folders:
    - map: ~/Projects
      to: /home/vagrant/Projects</p>

    <p>sites:
    - map: homestead.app
      to: /home/vagrant/Projects/laravel/public</p>

    <p>databases:
    - homestead</p>

    <p>variables:
    - key: APP_ENV
      value: local</p>

    <h1 id="blackfire">blackfire:</h1>
    <p>#     - id: foo
#       token: bar</p>

    <p>```</p>
  </li>
  <li>
    <p>Edit hosts file /etc/hosts and add this line at its end:</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>192.168.10.10 homestead.app
</code></pre>
    </div>
  </li>
  <li>
    <p>Setup secure shell (ssh) key</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>ssh-keygen -t rsa -C "you@homestead"
</code></pre>
    </div>
  </li>
  <li>
    <p>Run homestead virtual machine</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>homestead up
</code></pre>
    </div>
  </li>
  <li>
    <p>SSH to homestead virtual machine</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>homestead ssh
</code></pre>
    </div>
  </li>
  <li>
    <p>Install Laravel in your Projects directory (/home/vagrant/Projects)</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>composer create-project laravel/laravel --prefer-dist
</code></pre>
    </div>
  </li>
  <li>
    <p>Now open your browser on Mac and type <a href="http://homestead.app">http://homestead.app</a></p>
  </li>
</ol>

<p>You will get fancy welcome screen of Laravel 5.</p>

<p><img src="/assets/laravel-homestead-the-real-installation-guide/laravel-5-welcome-1.png" alt="Laravel 5" /></p>

<p>By the way, take a look inside Projects folder on your Mac. You will find laravel subfolder there.</p>

<p>If you want to use Lumen, just get out of vagrant virtual machine (exit ssh) and install Lumen using composer:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	composer global require "laravel/lumen-installer=~1.0"
</code></pre>
</div>

<p>SSH again into running Homestead virtual machine and create Lumen installation in Projects directory:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	composer create-project laravel/lumen --prefer-dist
</code></pre>
</div>

<p>To add Lumen site, just edit Homestead.yaml (homestead edit) and add new site into -sites: section of this configuration file.</p>

<h2 id="section-1">```</h2>
<p>ip: “192.168.10.10”
memory: 2048
cpus: 1
provider: virtualbox</p>

<p>authorize: ~/.ssh/id_rsa.pub</p>

<p>keys:
    - ~/.ssh/id_rsa</p>

<p>folders:
    - map: ~/Projects
      to: /home/vagrant/Projects</p>

<p>sites:
    - map: homestead.app
      to: /home/vagrant/Projects/laravel/public
    - map: lumen.app
      to: /home/vagrant/Projects/lumen/public</p>

<p>databases:
    - homestead</p>

<p>variables:
    - key: APP_ENV
      value: local</p>

<h1 id="blackfire-1">blackfire:</h1>
<p>#     - id: foo
#       token: bar</p>

<p>```</p>

<p>Once you have this, you need to add lumen.app to you /etc/hosts:</p>

<p><code class="highlighter-rouge">
##
# Host Database
#
# localhost is used to configure the loopback interface
# when the system is booting.  Do not change this entry.
##
127.0.0.1       localhost
255.255.255.255 broadcasthost
::1             localhost
192.168.10.10   homestead.app
192.168.10.10   lumen.app
</code></p>

<p>Restart Homestead VM:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>homestead halt
homestead up
</code></pre>
</div>

<p>I don’t know why, but <strong>homestead provision</strong> does not seem to reflect changes in Homestead.yaml file.</p>

<p>Then you can access Lumen installation from Safari on http://lumen.app</p>

<p>Ok, now that you have it up and running, let’s see what happened here.</p>

<h3 id="explain">Explain</h3>

<p>You can install a lot of development stuff right into your Mac and sometimes you might not even have another choice (like XCode), but sometimes you have. If you want to keep your Mac isolated from different development environments, you can use virtual machines. I already run Windows 7 and Ubuntu Linux on Parallels Desktop, so I can easily setup new Ubuntu right there and then install all tools for my development environment, but it’s a lot of installing and editing of config files, etc. Wouldn’t it be great if you can somehow get everything out of the box? I mean not only operating system, but all the tools coming with it already set up specifically for your needs. Well, now you can achieve this with Vagrant.</p>

<p>I don’t want to go to details, because you can always go to <a href="http://www.vagrantup.com">http://www.vagrantup.com</a> and learn everything about Vagrant. I will just say that this is a tool that will help you setup quickly and easily  portable development environments. You can go even further with Docker where you don’t need full operating system as with Vagrant box, but that’s another story.</p>

<p>I tried my best to but couldn’t find the way to run Homestead inside nested virtual machine. I wanted to get even further and totally isolate everything from my Mac OS X (even Vagrant!) and run it all inside dedicated VM. But Vagrant is tied with VirtualBox and that’s it’s weakness because VirtualBox does not support nested VM properly. Host VM does not pass all the stuff to guest VM. Vagrant offers some paid solution with VMware instead of VirtualBox, but I didn’t go that far.</p>

<p>This is as far as I got:</p>

<blockquote>
  <p>Sometimes especially in nested VM (Ubuntu VM on Mac via Parallels Desktop in my case) <em>homestead up</em> will end up with <em>default: Warning: Connection timeout. Retrying…</em> repeated many times.</p>
</blockquote>

<blockquote>
  <p>It looks like when you run <em>homestead up</em>, it aborts nested VM during initialization process. When it starts VM again, VM needs you to select the mode in which it should run, but since you don’t see this GUI screen, you have no idea what’s going on and why you see only Connection timeout while Ubuntu inside VirtualBox is waiting patiently for you input (selection from start menu).</p>
</blockquote>

<blockquote>
  <p>To fix this just start Virtualbox GUI from virtualized Ubuntu terminal. You will be presented with <em>Oracle VM VirtualBox Manager</em> where you will see your Homestead VM with the state <em>Aborted</em>.</p>
</blockquote>

<blockquote>
  <p>Start Homestead VM from <em>Oracle VM VirtualBox Manager</em>, wait for welcome screen and select *Ubuntu. Wait some more for few error messages(tsc, soft lockup) and Ubuntu 14.10 loading screen with another error. Then it should just run with no other error messages and in you will see <em>Running</em> state in VM Manager. You should be able now to ssh into homestead from new terminal window.</p>
</blockquote>

<p>After more testing of this workaround I realized it doesn’t work every time and that the main problem is in VirtualBox and it’s bad support for nested virtual machines.</p>

<p>On the other hand it’s not really wise to run VM inside VM, because it will consume a lot of resources. Imagine you have:
1) hypervisor (e.g. VMware Fusion) running on Mac
2) Linux running inside that hypervisor
3) another hypervisor (VirtualBox) running on virtualized Linux
4) Homestead (which is basically another Ubuntu Linux setup for Laravel development)</p>

<p>So in order to run Laravel you need A LOT of resources.</p>

<p>With Vagrant running directly from Mac OS X, you save step 1 and 2 and run only VirtualBox and Ubuntu (Homestead) inside as VM.</p>

<p>There is of course another way. Drop Homestead and install Laravel manually (not that hard at all). I tried this with Ubuntu on VMware Fusion. But it is somehow slower especially when you use PhpStorm. So I gave up with experiments and settled with the solution described above.</p>

<p>If you followed my steps you have a brand new virtual machine installed, configured and running in VirtualBox. This virtual machine is ready for development, because it contains PHP, HHVM, Nginx, MySQL, Postgres, Node (With Bower, Grunt, and Gulp), Redis, Memcached, Beanstalkd, Laravel Envoy, Fabric and HipChat Extension. I don’t even know what all this means, but I know I have it ready so I don’t need to configure it myself, which is a huge time saver (EDIT: Not really, compared to setup of nginx with php on Ubuntu, you won’t save so much time, but it’s neat.)</p>

<p>So you have your Mac running OS X. You have virtual machine running in VirtualBox called Homestead. This is basically just regular Ubuntu Linux configured by folks behind Laravel, so you don’t need to install all the required stuff manually.</p>

        </section>

        

        <footer class="post-footer">
            
            <!-- Share links section //-->
            <section class="share">
    <i class="fa fa-1x fa-share-square"></i>
    <h4>share this post</h4>
    <a href="http://twitter.com/share?text=Laravel/Homestead - the real installation guide&amp;url=/2015/03/30/laravel-homestead-the-real-installation-guide.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;"><i class="fa fa-1x fa-twitter"></i></a>
    <a href="https://www.facebook.com/sharer/sharer.php?u=/2015/03/30/laravel-homestead-the-real-installation-guide.html" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;"><i class="fa fa-1x fa-facebook-square"></i></a>
    <a href="https://plus.google.com/share?url=/2015/03/30/laravel-homestead-the-real-installation-guide.html" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;"><i class="fa fa-1x fa-google-plus-square"></i></a>
</section>



            <!-- Disqus comments -->
            

        </footer>

    </article>

</main>



    <footer class="site-footer clearfix">


      <section class="follow">
    <!-- <h4>Follow me</h4> //-->
		
			<a onClick="ga('send', 'event', 'Social Follow', 'Follow me on Facebook');" class="facebook_follow" title="Follow me on Facebook" href="http://www.facebook.com/zavrelj" target="_blank"><i class="fa fa-1x fa-facebook-square"></i></a>
		
		
			<a onClick="ga('send', 'event', 'Social Follow', 'Follow me on Twitter');" class="twitter_follow" title="Follow me on Twitter" href="https://twitter.com/zavrelj" target="_blank"><i class="fa fa-1x fa-twitter"></i></a>
		
		
		
		
			<a onClick="ga('send', 'event', 'Social Follow', 'Follow me on GitHub');" class="github_follow" title="Follow me on GitHub" href="https://github.com/zavrelj" target="_blank"><i class="fa fa-1x fa-github"></i></a>
		
    
			<a onClick="ga('send', 'event', 'Social Follow', 'Follow me on Bitbucket');" class="bitbucket_follow" title="Follow me on Bitbucket" href="https://bitbucket.org/zavrelj" target="_blank"><i class="fa fa-1x fa-bitbucket"></i></a>
		
</section>



      <section class="copyright">
          &copy; 2015 <a href="">jan.zavrel.net</a>
          <a href="/about.html">about</a>
      </section>
      <section class="poweredby">
          Made with <a href="http://jekyllrb.com">Jekyll</a> using <a href="https://github.com/zavrelj/ghost-for-jekyll-theme">Ghost for Jekyll Theme</a>
      </section>
    </footer>

    <script type="text/javascript" src="/assets/js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/assets/js/index.js"></script>

    <!-- Google Analytics Tracking code -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', '']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
</body>
</html>
